<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Estate Admin Portal</title>
    <link rel="stylesheet" href="admin-home.css">
</head>
<body>
    <div class="header">
        <a href="admin-bookings.html">
            <button class="view-bookings">View Bookings</button>
        </a>
    </div>
    <h1>Namastay Admin Portal</h1>
    <form id="property-form">
        <input type="text" id="name" placeholder="Property Name" required>
        <input type="text" id="location" placeholder="Location" required>
        <input type="number" id="price" placeholder="Price" required>
        <textarea id="description" placeholder="Description" required></textarea>
        <input type="file" id="image" accept="image/*" required>
        <button type="submit">Add Property</button>
    </form>
    <h2>Property List</h2>
    <div id="property-list"></div>

</body>
</html>

<script>
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDZq-Dz5dkj-I_-x6jNbr0HV4iV61LVd20",
  authDomain: "namastay-fa137.firebaseapp.com",
  databaseURL: "https://namastay-fa137-default-rtdb.firebaseio.com",
  projectId: "namastay-fa137",
  storageBucket: "namastay-fa137.appspot.com",
  messagingSenderId: "591100525672",
  appId: "1:591100525672:web:d826c565a424d5e2838fdd",
  measurementId: "G-BV1H3F10JN"
};


firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// Reference to the form and property list
const propertyForm = document.getElementById('property-form');
const propertyList = document.getElementById('property-list');

// Submit form and add property to Firestore
propertyForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const name = document.getElementById('name').value;
    const location = document.getElementById('location').value;
    const price = document.getElementById('price').value;
    const description = document.getElementById('description').value;
    const image = document.getElementById('image').files[0];

    // Create a storage reference
    const storageRef = storage.ref('properties/' + image.name);

    // Upload the image to Firebase Storage
    const uploadTask = storageRef.put(image);

    uploadTask.on('state_changed', 
        (snapshot) => {
            // Optional: Handle the progress of the upload
            let progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            console.log('Upload is ' + progress + '% done');
        }, 
        (error) => {
            console.error('Error uploading image: ', error);
        }, 
        () => {
            // Get the image download URL and add the property details to Firestore
            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                db.collection('properties').add({
                    name: name,
                    location: location,
                    price: price,
                    description: description,
                    imageUrl: downloadURL
                }).then(() => {
                    console.log('Property added successfully');
                    propertyForm.reset();
                    loadProperties(); // Refresh the list
                }).catch((error) => {
                    console.error('Error adding property: ', error);
                });
            });
        }
    );
});

// Load properties from Firestore and display them
function loadProperties() {
    propertyList.innerHTML = ''; // Clear the list
    db.collection('properties').get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
            const property = doc.data();
            const propertyDiv = document.createElement('div');
            propertyDiv.classList.add('property');
            propertyDiv.innerHTML = `
                <h3>${property.name}</h3>
                <p>Location: ${property.location}</p>
                <p>Price: $${property.price}</p>
                <p>${property.description}</p>
                <img src="${property.imageUrl}" alt="${property.name}">
            `;
            propertyList.appendChild(propertyDiv);
        });
    });
}

// Initial load of properties
loadProperties();

</script>